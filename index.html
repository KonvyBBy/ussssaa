<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Konvy Accounts — Black & White</title>
<style>
:root{ --bg:#000; --fg:#fff; --muted: #bdbdbd; }
*{box-sizing:border-box}
html,body{height:100%;}
body{
  margin:0; background:var(--bg); color:var(--fg); font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
  display:grid; place-items:center; padding:24px;
}
.container{width:100%;max-width:920px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.06); padding:32px; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,0.6)}
header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#fff,#ccc);display:flex;align-items:center;justify-content:center;color:#000;font-weight:700; font-size:20px;box-shadow:0 8px 30px rgba(255,255,255,0.06) inset}
h1{margin:0;font-size:20px}
p.lead{margin:0;color:var(--muted);font-size:13px}
.grid{display:grid;grid-template-columns:1fr 420px;gap:28px}
@media (max-width:880px){.grid{grid-template-columns:1fr}}
.left{display:flex;flex-direction:column;gap:12px}
.card{background:transparent;padding:18px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
.form{display:flex;flex-direction:column;gap:10px}
label{font-size:13px;color:var(--muted)}
input[type=text], input[type=password], input[type=email]{background:transparent;border:1px solid rgba(255,255,255,0.08);padding:10px;border-radius:8px;color:var(--fg);font-size:15px}
button{background:var(--fg); color:var(--bg); border:none;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer}
.muted{color:var(--muted);font-size:13px}
.switcher{display:flex;gap:8px;margin-bottom:8px}
.switcher button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--fg);padding:8px 10px;border-radius:8px;font-weight:600}
.switcher button.active{background:rgba(255,255,255,0.92);color:var(--bg)}
.center{display:flex;align-items:center;justify-content:center;height:100%}
footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:var(--fg);cursor:pointer}
.hidden{display:none;}
#owner-controls{margin-top:12px;}
#owner-controls input{width:100%;margin-bottom:6px;}
#orders-table, #keys-table{width:100%; border-collapse:collapse; margin-top:12px;}
#orders-table th, #orders-table td, #keys-table th, #keys-table td{border-bottom:1px solid rgba(255,255,255,0.2); padding:6px; text-align:left;}
</style>
</head>
<body>
<div class="container">
<header>
  <div class="logo">K</div>
  <div>
    <h1>Konvy AccountsXD</h1>
    <p class="lead">Redeem keys, view order history, manage products if owner.</p>
  </div>
</header>

<div class="grid">
  <div class="left">
    <div class="card">
      <div class="switcher">
        <button id="btn-login" class="active">Login</button>
        <button id="btn-signup">Sign up</button>
      </div>

      <div id="forms">
        <!-- Login form -->
        <form id="login-form" class="form">
          <label for="login-email">Email</label>
          <input id="login-email" type="email" required placeholder="you@example.com">
          <label for="login-password">Password</label>
          <input id="login-password" type="password" required placeholder="password">
          <button type="submit">Sign in</button>
        </form>

        <!-- Signup form -->
        <form id="signup-form" class="form" style="display:none">
          <label for="signup-username">Username</label>
          <input id="signup-username" type="text" required placeholder="username">
          <label for="signup-email">Email</label>
          <input id="signup-email" type="email" required placeholder="you@example.com">
          <label for="signup-password">Password</label>
          <input id="signup-password" type="password" required placeholder="password">
          <button type="submit">Create account</button>
        </form>
      </div>
    </div>
  </div>

  <div>
    <div class="card dashboard" id="main-area">
      <div class="nav">
        <div>
          <strong id="welcome">Welcome</strong>
          <div class="muted" id="user-email">Not signed in</div>
        </div>
        <div>
          <button id="logout-btn" class="btn-ghost hidden">Logout</button>
        </div>
      </div>

      <div id="dash-content" style="min-height:220px;display:flex;flex-direction:column;">
        <div class="center muted">Blank dashboard — nothing here yet.</div>
      </div>

      <!-- Redeem key input -->
      <div id="redeem-section" class="hidden" style="margin-top:12px;">
        <input type="text" id="redeem-key-input" placeholder="Enter product key">
        <button id="redeem-key-btn">Redeem Key</button>
        
        <!-- Order History Table -->
        <h4>Your Orders</h4>
        <table id="orders-table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Redeemed At</th>
            </tr>
          </thead>
          <tbody id="orders-list"></tbody>
        </table>
      </div>

      <!-- Owner controls -->
      <div id="owner-controls" class="hidden">
        <h4>Owner Controls: Create Key</h4>
        <input type="text" id="owner-product-name" placeholder="Product Name">
        <input type="text" id="owner-key" placeholder="Key">
        <button id="create-key-btn">Create Key</button>

        <!-- Owner Keys Table -->
        <h4>All Keys</h4>
        <table id="keys-table">
          <thead>
            <tr>
              <th>Key</th>
              <th>Product</th>
              <th>Status</th>
              <th>Redeemed By</th>
            </tr>
          </thead>
          <tbody id="keys-list"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<footer>
  Built with Firebase Authentication & Firestore — works across devices.
</footer>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD2M35gv68ILULRqlRVlO5E4oLCXbj1RaM",
  authDomain: "konvy-57910.firebaseapp.com",
  projectId: "konvy-57910",
  storageBucket: "konvy-57910.firebasestorage.app",
  messagingSenderId: "97699914787",
  appId: "1:97699914787:web:f2ba164292f3a3f07ebd96",
  measurementId: "G-330N3W9E4N"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// UI elements
const btnLogin = document.getElementById('btn-login');
const btnSignup = document.getElementById('btn-signup');
const loginForm = document.getElementById('login-form');
const signupForm = document.getElementById('signup-form');
const logoutBtn = document.getElementById('logout-btn');
const welcomeEl = document.getElementById('welcome');
const userEmailEl = document.getElementById('user-email');
const dashContent = document.getElementById('dash-content');
const redeemSection = document.getElementById('redeem-section');
const redeemInput = document.getElementById('redeem-key-input');
const redeemBtn = document.getElementById('redeem-key-btn');
const ordersList = document.getElementById('orders-list');
const ownerControls = document.getElementById('owner-controls');
const ownerProductName = document.getElementById('owner-product-name');
const ownerKeyInput = document.getElementById('owner-key');
const createKeyBtn = document.getElementById('create-key-btn');
const keysList = document.getElementById('keys-list');

// Switch tabs
btnLogin.addEventListener('click', ()=>{ btnLogin.classList.add('active'); btnSignup.classList.remove('active'); loginForm.style.display='block'; signupForm.style.display='none'; });
btnSignup.addEventListener('click', ()=>{ btnSignup.classList.add('active'); btnLogin.classList.remove('active'); loginForm.style.display='none'; signupForm.style.display='block'; });

// Owner special key
const OWNER_KEY = "KDFIHFdawdd124345#$@#FIGwdwdaHE@";
db.collection("keys").doc(OWNER_KEY).get().then(doc=>{
  if(!doc.exists){
    db.collection("keys").doc(OWNER_KEY).set({product:"Owner Access", role:"owner", used:false});
  }
});

// Signup
signupForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const username = document.getElementById('signup-username').value.trim();
  const email = document.getElementById('signup-email').value.trim();
  const password = document.getElementById('signup-password').value;

  try{
    const userCredential = await auth.createUserWithEmailAndPassword(email,password);
    await db.collection("users").doc(userCredential.user.uid).set({username, role:"user"});
    alert("Signup successful! Please login.");
    loginForm.style.display='block';
    signupForm.style.display='none';
    btnLogin.classList.add('active');
    btnSignup.classList.remove('active');
  } catch(err){ alert(err.message); }
});

// Login
loginForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const email = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value;
  try{
    const userCredential = await auth.signInWithEmailAndPassword(email,password);
    const userDoc = await db.collection("users").doc(userCredential.user.uid).get();
    const userData = userDoc.data();
    renderSignedIn(userData.username,email,userData.role);
  } catch(err){ alert(err.message); }
});

// Logout
logoutBtn.addEventListener('click', async ()=>{
  await auth.signOut();
  renderSignedOut();
});

// Render functions
function renderSignedIn(username,email,role){
  welcomeEl.textContent = `Hi, ${username}`;
  userEmailEl.textContent = email;
  logoutBtn.classList.remove('hidden');
  dashContent.innerHTML = '<div class="center muted">Blank dashboard — nothing here yet.</div>';
  document.querySelector('.card .switcher').style.display='none';
  loginForm.style.display='none';
  signupForm.style.display='none';
  redeemSection.classList.remove('hidden');

  if(role==="owner") ownerControls.classList.remove('hidden');
  else ownerControls.classList.add('hidden');

  loadOrders();
  if(role==="owner") loadKeys();
}

function renderSignedOut(){
  welcomeEl.textContent = 'Welcome';
  userEmailEl.textContent = 'Not signed in';
  logoutBtn.classList.add('hidden');
  document.querySelector('.card .switcher').style.display='flex';
  loginForm.style.display='block';
  signupForm.style.display='none';
  dashContent.innerHTML = '<div class="center muted">Blank dashboard — nothing here yet.</div>';
  redeemSection.classList.add('hidden');
  ownerControls.classList.add('hidden');
  ordersList.innerHTML="";
  keysList.innerHTML="";
}

// Redeem key
redeemBtn.addEventListener('click', async ()=>{
  const key = redeemInput.value.trim();
  if(!key) return alert("Enter a key");
  const user = auth.currentUser;

  const keyDocRef = db.collection("keys").doc(key);
  const keyDoc = await keyDocRef.get();
  if(!keyDoc.exists) return alert("Invalid key");

  const keyData = keyDoc.data();
  if(keyData.used) return alert("This key has already been redeemed");

  await keyDocRef.update({used:true, redeemedBy:user.uid, redeemedAt:firebase.firestore.Timestamp.now()});
  await db.collection("orders").add({userId:user.uid,key:key,product:keyData.product,redeemedAt:firebase.firestore.Timestamp.now()});

  if(keyData.role==="owner"){
    await db.collection("users").doc(user.uid).update({role:"owner"});
    alert("Owner role granted!");
    renderSignedIn(user.email,user.email,"owner");
  } else {
    alert(`Redeemed ${keyData.product}`);
  }

  redeemInput.value="";
  loadOrders();
  if(auth.currentUser) loadKeys();
});

// Owner create key
createKeyBtn.addEventListener('click', async ()=>{
  const product = ownerProductName.value.trim();
  const key = ownerKeyInput.value.trim();
  if(!product || !key) return alert("Fill product and key");
  await db.collection("keys").doc(key).set({product, role:"user", used:false});
  alert("Key created!");
  ownerProductName.value="";
  ownerKeyInput.value="";
  loadKeys();
});

// Load customer orders
async function loadOrders(){
  const user = auth.currentUser;
  const snapshot = await db.collection("orders").where("userId","==",user.uid).orderBy("redeemedAt","desc").get();
  ordersList.innerHTML="";
  if(snapshot.empty){
    const tr = document.createElement("tr");
    tr.innerHTML=`<td colspan="2" style="color:var(--muted)">No orders yet</td>`;
    ordersList.appendChild(tr);
    return;
  }
  snapshot.forEach(doc=>{
    const d = doc.data();
    const date = d.redeemedAt.toDate().toLocaleString();
    const tr = document.createElement("tr");
    tr.innerHTML=`<td>${d.product}</td><td>${date}</td>`;
    ordersList.appendChild(tr);
  });
}

// Load keys for owner
async function loadKeys(){
  const snapshot = await db.collection("keys").get();
  keysList.innerHTML="";
  snapshot.forEach(doc=>{
    const d = doc.data();
    const tr = document.createElement("tr");
    tr.innerHTML=`<td>${doc.id}</td><td>${d.product}</td><td>${d.used?"Used":"Unused"}</td><td>${d.redeemedBy||"-"}</td>`;
    keysList.appendChild(tr);
  });
}

// Check current user on page load
auth.onAuthStateChanged(async user=>{
  if(user){
    const userDoc = await db.collection("users").doc(user.uid).get();
    const userData = userDoc.data();
    renderSignedIn(userData.username,user.email,userData.role);
  } else renderSignedOut();
});
</script>
</body>
</html>
